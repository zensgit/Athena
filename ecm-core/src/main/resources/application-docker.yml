# Docker profile - 覆盖 application.yml 中的配置
spring:
  # Redis is used for queues, but we intentionally keep Spring Cache in-memory in Docker/CI.
  # Otherwise @Cacheable on preview APIs can end up using Redis DefaultSerializer and fail on complex payloads.
  cache:
    type: simple
  datasource:
    url: ${SPRING_DATASOURCE_URL:jdbc:postgresql://postgres:5432/ecm_db}
    username: ${SPRING_DATASOURCE_USERNAME:ecm_user}
    password: ${SPRING_DATASOURCE_PASSWORD:ecm_password}
  jpa:
    hibernate:
      ddl-auto: update

  elasticsearch:
    uris: ${SPRING_ELASTICSEARCH_URIS:http://elasticsearch:9200}

  data:
    redis:
      host: ${SPRING_DATA_REDIS_HOST:redis}
      password: ${SPRING_DATA_REDIS_PASSWORD:redis_password}

  rabbitmq:
    host: ${SPRING_RABBITMQ_HOST:rabbitmq}
    username: ${SPRING_RABBITMQ_USERNAME:rabbitmq}
    password: ${SPRING_RABBITMQ_PASSWORD:rabbitmq_password}

  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: ${SPRING_SECURITY_OAUTH2_RESOURCESERVER_JWT_ISSUER_URI:http://keycloak:8080/realms/ecm}
          jwk-set-uri: ${SPRING_SECURITY_OAUTH2_RESOURCESERVER_JWT_JWK_SET_URI:http://keycloak:8080/realms/ecm/protocol/openid-connect/certs}

ecm:
  identity:
    provider: ${ECM_IDENTITY_PROVIDER:keycloak}

  keycloak:
    url: ${ECM_KEYCLOAK_URL:http://keycloak:8080}
    realm: ${ECM_KEYCLOAK_REALM:ecm}
    admin-realm: ${ECM_KEYCLOAK_ADMIN_REALM:master}
    admin-client-id: ${ECM_KEYCLOAK_ADMIN_CLIENT_ID:admin-cli}
    admin-username: ${ECM_KEYCLOAK_ADMIN_USERNAME:}
    admin-password: ${ECM_KEYCLOAK_ADMIN_PASSWORD:}

  storage:
    root-path: ${ECM_STORAGE_ROOT_PATH:/var/ecm/content}
    temp-path: ${ECM_STORAGE_TEMP_PATH:/var/ecm/temp}

  conversion:
    enabled: ${ECM_CONVERSION_ENABLED:true}
    max-file-size: ${ECM_CONVERSION_MAX_FILE_SIZE:100MB}

  search:
    refresh-after-write: ${ECM_SEARCH_REFRESH_AFTER_WRITE:true}

  ml:
    service:
      url: ${ECM_ML_SERVICE_URL:http://ml-service:8080}
    enabled: ${ECM_ML_ENABLED:true}

  antivirus:
    enabled: ${ECM_ANTIVIRUS_ENABLED:true}
    clamd:
      host: ${ECM_ANTIVIRUS_CLAMD_HOST:clamav}
      port: ${ECM_ANTIVIRUS_CLAMD_PORT:3310}

minio:
  endpoint: ${MINIO_ENDPOINT:http://minio:9000}
