spring:
  application:
    name: ecm-core
  
  datasource:
    url: jdbc:postgresql://localhost:5432/ecm_db
    username: ecm_user
    password: ecm_password
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 20
      minimum-idle: 5
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
  
  jpa:
    database-platform: org.hibernate.dialect.PostgreSQLDialect
    hibernate:
      ddl-auto: validate
    properties:
      hibernate:
        format_sql: true
        jdbc:
          lob:
            non_contextual_creation: true
        types:
          print:
            banner: false
    show-sql: false
  
  liquibase:
    change-log: classpath:db/changelog/db.changelog-master.xml
    enabled: true
  
  elasticsearch:
    uris: http://localhost:9200
    username: elastic
    password: elastic_password
    connection-timeout: 5s
    socket-timeout: 30s
  
  data:
    redis:
      host: localhost
      port: 6379
      password: redis_password
      timeout: 2000ms
      lettuce:
        pool:
          max-active: 8
          max-idle: 8
          min-idle: 0
  
  rabbitmq:
    host: localhost
    port: 5672
    username: rabbitmq
    password: rabbitmq_password
    virtual-host: /
  
  servlet:
    multipart:
      enabled: true
      max-file-size: 500MB
      max-request-size: 500MB
  
  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: ${SPRING_SECURITY_OAUTH2_RESOURCESERVER_JWT_ISSUER_URI:http://keycloak:8080/realms/ecm}
          jwk-set-uri: ${SPRING_SECURITY_OAUTH2_RESOURCESERVER_JWT_JWK_SET_URI:http://keycloak:8080/realms/ecm/protocol/openid-connect/certs}

flowable:
  database-schema-update: true
  async-executor-activate: true
  history-level: full
  
jodconverter:
  local:
    enabled: true
    office-home: /usr/lib/libreoffice
    port-numbers: 2002
    max-tasks-per-process: 10
    process-timeout: 120000

ecm:
  audit:
    retention-days: ${ECM_AUDIT_RETENTION_DAYS:365}

  mail:
    processed:
      retention-days: ${ECM_MAIL_PROCESSED_RETENTION_DAYS:90}

  identity:
    provider: ${ECM_IDENTITY_PROVIDER:local}

  keycloak:
    url: ${ECM_KEYCLOAK_URL:http://keycloak:8080}
    realm: ${ECM_KEYCLOAK_REALM:ecm}
    admin-realm: ${ECM_KEYCLOAK_ADMIN_REALM:master}
    admin-client-id: ${ECM_KEYCLOAK_ADMIN_CLIENT_ID:admin-cli}
    admin-username: ${ECM_KEYCLOAK_ADMIN_USERNAME:}
    admin-password: ${ECM_KEYCLOAK_ADMIN_PASSWORD:}

  storage:
    type: filesystem
    root-path: /var/ecm/content
    temp-path: /var/ecm/temp

  tika:
    max-text-length: 10485760  # 10MB of text

  security:
    jwt:
      secret: ${JWT_SECRET:mySecretKey}
      expiration: 86400000
    cors:
      allowed-origins: "*"
      allowed-methods: "*"
      allowed-headers: "*"
      exposed-headers: "Authorization,Link,X-Total-Count"
      allow-credentials: true
      max-age: 3600
  
  preview:
    cache:
      enabled: true
      ttl: 3600
    max-pages: 50
    thumbnail:
      width: 200
      height: 200
      quality: 0.8
    cad:
      enabled: ${ECM_PREVIEW_CAD_ENABLED:true}
      render-url: ${ECM_PREVIEW_CAD_RENDER_URL:}
      auth-token: ${ECM_PREVIEW_CAD_AUTH_TOKEN:}
      timeout-ms: ${ECM_PREVIEW_CAD_TIMEOUT_MS:30000}
  
  conversion:
    output-formats:
      - pdf
      - html
      - txt
      - png
      - jpg
    max-file-size: 100MB
    timeout: 300000
  
  workflow:
    definitions-path: classpath:workflows/
    auto-deploy: true
  
  search:
    enabled: true
    index-name: ecm_documents
    batch-size: 100
    refresh-after-write: false
    highlight:
      enabled: true
      pre-tag: "<em>"
      post-tag: "</em>"
  
  alfresco:
    compatibility:
      enabled: true
      version: 7.0
  
  odoo:
    url: http://localhost:8069
    database: odoo_db
    username: admin
    password: admin_password
    api-key: ${ODOO_API_KEY:}

  antivirus:
    enabled: ${ECM_ANTIVIRUS_ENABLED:false}
    clamd:
      host: ${ECM_ANTIVIRUS_CLAMD_HOST:localhost}
      port: ${ECM_ANTIVIRUS_CLAMD_PORT:3310}
      timeout: ${ECM_ANTIVIRUS_CLAMD_TIMEOUT:30000}
    on-threat:
      action: reject  # reject or quarantine
      quarantine-path: /var/ecm/quarantine

logging:
  level:
    root: INFO
    com.ecm: DEBUG
    org.springframework.security: INFO
    org.flowable: WARN
    org.elasticsearch: WARN
    org.apache.pdfbox: WARN
    org.jodconverter: WARN
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
  file:
    name: logs/ecm-core.log
    max-size: 10MB
    max-history: 30

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  metrics:
    export:
      prometheus:
        enabled: true
    tags:
      application: ${spring.application.name}

server:
  port: ${SERVER_PORT:8080}
  compression:
    enabled: true
    mime-types: text/html,text/xml,text/plain,text/css,text/javascript,application/javascript,application/json
    min-response-size: 1024
